---
layout: default
---

{% comment %}
  Use page content directly (from markdown file)
  Navigation generated from db-levels collection
{% endcomment %}
{% assign level_content = content %}
{% assign current_level_num = page.number %}

<div class="level-navigation">
  <div class="nav-container">
    <span class="nav-label">Level Navigation:</span>
    {% comment %}
      Generate navigation from levels collection
      Sort by number to ensure correct order
    {% endcomment %}
    {% comment %} Determine collection name from page context {% endcomment %}
    {% if page.lesson_slug %}
      {% assign collection_name = page.lesson_slug | append: '-levels' %}
    {% else %}
      {% assign collection_name = site.level_manager.collection_name | default: 'levels' %}
    {% endif %}
    
    {% comment %} Access collection directly (works better in Liquid) {% endcomment %}
    {% if collection_name == 'apple-clicker-levels' %}
      {% assign sorted_levels = site.apple-clicker-levels | sort: 'number' %}
    {% elsif collection_name == 'example-lesson-levels' %}
      {% assign sorted_levels = site.example-lesson-levels | sort: 'number' %}
    {% else %}
      {% assign levels_collection = site.collections[collection_name] %}
      {% if levels_collection and levels_collection.docs %}
        {% assign sorted_levels = levels_collection.docs | sort: 'number' %}
      {% else %}
        {% assign sorted_levels = null %}
      {% endif %}
    {% endif %}
    {% if sorted_levels %}
      {% for level in sorted_levels %}
        {% if level.number == current_level_num %}
          <strong class="active-level">{{ level.number }}</strong>
        {% else %}
          <a href="{{ level.url | relative_url }}" class="level-nav-link">
            {{ level.number }}{% if level.number == 19 %}âš¡{% endif %}
          </a>
        {% endif %}
        {% unless forloop.last %} | {% endunless %}
      {% endfor %}
    {% else %}
      <span>No levels available</span>
    {% endif %}
  </div>
</div>

{% comment %}
  Process content: First render as Liquid template (to process showme tags),
  then convert markdown to HTML
  The liquid_markdownify filter handles both steps
{% endcomment %}
{{ level_content | liquid_markdownify }}

